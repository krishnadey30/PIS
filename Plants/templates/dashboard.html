{% load static %}
{% load app_tags %}
<!DOCTYPE html>
<html>
<title>I-F</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">


<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<style>
body,h1,h5 {font-family: "Raleway", sans-serif}
body, html {height: 100%}
.user {
  display: inline-block;
  width: 50px;
  height: 50px;
  border-radius: 50%;

  object-fit: cover;
}
/* strat */
.bgimg {
    background-image: url({% static 'Plants/images/pla.jpg' %});
    min-height: 100%;
    background-position: center;
    background-size: cover;
}
/* end */
/* strat */
.dropbtn {
    background-color: #4CAF50;
    color: white;
    padding: 16px;
    font-size: 16px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #f9f9f9;
    min-width: 160px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.dropdown-content a {
    color: black;
    padding: 12px 16px;
    text-decoration: none;
    display: block;
}

.dropdown-content p:hover {background-color: orange}

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #3e8e41;
}

/* end */

#id1{
  background-color: black;
  opacity: 0.5;
}

#id2{
    width: 700px;
    height: 400px;
    background-color: black;
    box-shadow: 10px 15px 15px #888888;
}

div.gallery {
    border: 1px solid #ccc;
}

div.gallery:hover {
    border: 1px solid #777;
}

div.gallery img {
    width: 100%;
    height: auto;
}

div.desc {
    padding: 15px;
    text-align: center;
}

* {
    box-sizing: border-box;
}

.responsive {
    padding: 0 6px;
    float: left;
    width: 24.99999%;
}

@media only screen and (max-width: 500px){
    .responsive {
        width: 49.99999%;
        margin: 6px 0;
    }
}

@media only screen and (max-width: 500px){
    .responsive {
        width: 100%;
    }
}

.clearfix:after {
    content: "";
    display: table;
    clear: both;
}
.glass {
    margin: 30px auto;
    height: 300px;
    width: 200px;
    position: relative;
    background-color: transparent;
    border-style: none solid solid solid;
    border-width: 5px;
    border-color: #808080;
    border-radius: 10px;
   
}

.water {
    width: 100%;
    background-color: skyblue;
    position: absolute;
    bottom: 0;
}
.second_div{
  float: left;
  margin-left:15%;
  margin-top:5%;
}
.third_div{
  font-family: 'Source Code Pro', cursive;
  color:black;
  font-size:65px;
  text-align:center;
  text-shadow: 5px 5px gray;
  margin-top:15%;
}
.fourth_div{
  font-family: 'Source Code Pro', cursive;
  color:black;
  font-size:36px;
  text-align:center;
  text-shadow: 2px 2px pink;
  margin-top:1%;
}
</style>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    const showMap = (arr, elt) => {
    google.charts.load('current', {
      'packages': ['map'],
      'mapsApiKey': 'AIzaSyCUXATclYI8vfBPWa3HAYyn_Vj4xAZ4sgc'
    });
    google.charts.setOnLoadCallback(drawMap(arr, elt));

    function drawMap (arr, elt) {
      var data = new google.visualization.DataTable();
      data.addColumn('number', 'lat');
      data.addColumn('number', 'long');
      data.addColumn('string', 'Name');

      data.addRows(arr);

      var options = {
         zoomLevel: 6,
         enableScrollWheel: true,
        showTooltip: true,
        showInfoWindow: true,
        useMapTypeControl: true,
          icons: {
            default: {
              normal: '{% static 'Plants/images/tea-plant-leaf-icon.png' %}',
              selected: '{% static 'Plants/images/tea-plant-leaf-icon72.png' %}'
            }
          }
        };

        var map = new google.visualization.Map(document.querySelector(elt));
        map.draw(data, options);
      }
    }

  </script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

      
      const showGraph = (arr, elt) => {
        // console.log(arr)
        // Load the Visualization API and the corechart package.
        google.charts.load('current', {packages: ['corechart', 'line']});
        google.charts.setOnLoadCallback(drawChart(arr, elt));
        // Callback that creates and populates a data table,
        // instantiates the pie chart, passes in the data and
        // draws it.
        function drawChart(arr, elt) {
          // console.log(elt)
          // Create the data table.
          var data = new google.visualization.DataTable();
          data.addColumn('string', 'Time');
          data.addColumn('number', `values`);
          data.addRows(arr);
          var options = {
                         'width':600,
                         'height':300,
                          legend: { position: 'top', textStyle: {color: 'indigo', fontSize: 16}},
                          animation:{
                          duration: 1000,
                          easing: 'out',
                        },
                         axes: {
            x: {
              0: {side: 'botoom'}
            }
          },
          hAxis: {
            title: 'Date & Time'
          },
          vAxis: {
            title: 'values'
          }
                       };

          // Instantiate and draw our chart, passing in some options.
          var chart = new google.visualization.LineChart(document.querySelector(elt));
          chart.draw(data, options);
        }
      }
    </script>
<body class="bgimg w3-display-container w3-text-white" >
  <div><a href="/logout" class="w3-bar-item w3-button w3-hide-small" style="float:right;"> <i class="fa fa-user-times" ></i></a></div>
<div >
  <div class="w3-display-middle w3-jumbo">
    <!--<p><h3>dashboard</h3></p>-->
  </div>
  <nav id="id1" class="w3-sidebar w3-bar-block w3-small w3-hide-small w3-center" style="width:20%" >
  <div class="w3-display-topleft w3-container w3-xlarge">

    <br>
    &nbsp;&nbsp;<button onclick="document.getElementById('user').style.display='block'" class="w3-button w3-black">
      {% if userprofile %}<img src="{{ user.userprofile.picture.url }}" class="user" />{% else %}<i class="fa fa-user" style="font-size:70px;color:white;text-shadow:3px 3px 4px #000000;"></i>{% endif %}</button><br>
  
  <div class="dropdown">
    <p>Plants</p>
  <div class="dropdown-content">
    {% for plants in all_plants %}
     <p><button onclick="document.getElementById('sensor{{plants.id}}').style.display='block'" class="w3-button w3-black">{{plants.plant_name}}</button></p>
    {% endfor %}
  </div>
  </div>

  <br>
  <div class="dropdown">
    <p><button onclick="document.getElementById('AddPlant').style.display='block'" class="w3-button w3-black">Add Plant</button></p>
  </div>
  <br>
  <div class="dropdown">
    <p>Tanks</p>
  <div class="dropdown-content">
    {% for tanks in tank_all %}
   <p><button onclick="document.getElementById('tank{{tanks.id}}').style.display='block'" class="w3-button w3-black">Tank {{tanks.id}}</button></p>
   {% endfor %}
  </div>
  </div>
  
  <br>
  <div class="dropdown">
    <p>Graph: Plants</p>
    <div class="dropdown-content">
    {% for plants in all_plants %}
     <p><button onclick="document.getElementById('graph{{plants.id}}').style.display='block'" class="w3-button w3-black">{{plants.plant_name}}</button></p>
    {% endfor %}
  </div></div>
  <br>
  <div class="dropdown">
    <p>Graph: Tanks</p>
  <div class="dropdown-content">
    {% for tank in tank_all %}
   <p><button onclick="showGraph({{tanks | getkey:tank.id | safe}}, '#graphtank');document.getElementById('graphtank{{tank.id}}').style.display='block'" class="w3-button w3-black">Tank {{tank.id}}</button></p>
   {% endfor %}
  </div>
  </div>

  <br>
  <div class="dropdown">
    <p>Maps</p>
  <div class="dropdown-content">
<p><button onclick="showMap({{maps_plants|safe}},'#maps_plants'); document.getElementById('plantmap').style.display='block'" class="w3-button w3-black">Plant</button></p>
     <p><button onclick="showMap({{maps_tanks|safe}},'#maps_tanks');document.getElementById('tankmap').style.display='block'" class="w3-button w3-black">Tank</button></p>
  </div>
  </div>


  <div class="w3-display-bottomleft w3-container">
    
  </div>
</div>
</nav>

<div id="AddPlant" class="w3-modal" >
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black w3-display-container" >
      <span onclick="document.getElementById('AddPlant').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>Add Plant</h1>
    </div>
      <div class="w3-container">
        <br>
        <br> 
        <form action="/add/" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-sub-w3">
                  <input type="text" name="name" placeholder="Name " required="" />
                <div class="icon-w3">
                  <i class="fa fa-user" aria-hidden="true"></i>
                </div>
                </div>
                <div class="form-sub-w3">
                  <input type="text" name="tank_id" placeholder="Tank Id" required="" />
                <div class="icon-w3">
                  <i class="fa fa-unlock-alt" aria-hidden="true"></i>
                </div>
                </div>
                <div class="form-sub-w3">
                  <input type="text" name="ws_id" placeholder="Weather Station Id" required="" />
                <div class="icon-w3">
                  <i class="fa fa-unlock-alt" aria-hidden="true"></i>
                </div>
                </div>
                 
                <div class="clear"></div>
                <div class="submit-agileits">
                  <input type="submit" value="Add Plant">
                </div>
              </form>
            </div>
          </div>
        </div>

<!-- sensor values -->
{% for  plants in all_plants %}
<div id="sensor{{plants.id}}" class="w3-modal" >
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black w3-display-container" >
      <span onclick="document.getElementById('sensor{{plants.id}}').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>{{plants.plant_name}}</h1>
    </div>
      <div class="w3-container">
        <br>
        <br> 
                                <br> 
                                <div style="float: left;width: 50%;padding-left: 20px ;padding-right: 20px ;padding-bottom: 20px;">
                                        <div class="w3-card-4" style="width:100%">
                                         <p> <img src={% static 'Plants/images/temp.jpg' %} align="left" style="width:40%"> <h1 align="middle" style="color: black">{{plants.ws_key.ws_data_set.last.temp}} <sup>0</sup>C</h1></p>
                                          <div class="w3-container w3-center">
                                            <p><h3 style="color: green">Temperature</h3></p>
                                          </div>
                                        </div>
                                </div>
                                <div style="float: right; width:50%;padding-left: 20px ;padding-right: 20px ;padding-bottom: 20px;">
                                        <div class="w3-card-4" style="width:100%">
                                          <p><img src={% static 'Plants/images/humidity.jpg' %} align="left"  style="width:40%"> <h1 align="middle" style="color: black">{{plants.ws_key.ws_data_set.last.humidity}} %</h1></p>
                                          <div class="w3-container w3-center">
                                            <p><h3 style="color: green">Humidity</h3></p>
                                          </div>
                                        </div>
                                </div>
                              
                                <br>
                                 <div style="float: left;width: 50%;padding-left: 20px ;padding-right: 20px ;padding-top: 10px;">
                                        <div class="w3-card-4" style="width:100%">
                                         <p> <img src={% static 'Plants/images/rainfall.jpg' %} align="left" style="width:40%"> <h1 align="middle" style="color: black ">{{plants.ws_key.ws_data_set.last.rainfall}} mm</h1></p>
                                          <div class="w3-container w3-center">
                                            <p><h3 style="color: green">Rainfall</h3></p>
                                          </div>
                                        </div>
                                 
                                </div>
                                 <div style="float: left;width: 50%;padding-left: 20px ;padding-right: 20px ;padding-top: 10px;">
                                        <div class="w3-card-4" style="width:100%">
                                        <p>  <img src={% static 'Plants/images/soil.jpg' %} align="left" style="width:40%"> <h1 align="middle" style="color: black">{{plants.soil_data_set.last.moisture}} %</h1></p>
                                          <div class="w3-container w3-center">
                                            <p><h3 style="color: green">Soil Moisture</h3></p>
                                          </div>
                                        </div>
                                  </div>
                                </div>
                                <br>
              </div>

            <div class="clearfix"></div>
      </div>{% endfor %}
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>
  


<!--graphs-->
{% for tanks in tank_all %}
<div id="graphtank{{tanks.id}}" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black w3-display-container">
      <span onclick="document.getElementById('graphtank{{tanks.id}}').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1> Water Graph : Tank {{tanks.id}}</h1>
    </div>
    <div class="w3-container">
      <div id="graphtank"></div>
    </div>      
  </div>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
</div>
{% endfor %}

{% for  plants in all_plants %}
<div id="graph{{plants.id}}" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black">
      <span onclick="document.getElementById('graph{{plants.id}}').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>Graphs</h1></div>
      <div class="w3-container" >
        <br>
        <br> 
                <br> 
                <div style="float: left;width: 50%;padding-left: 40px ;padding-right: 0px ;padding-bottom: 20px;">
                        <div class="w3-card-4" style="width:100%;padding-left: 70px">
                          
                         <p><button onclick="showGraph({{temperature | getkey:plants.id | safe}}, '#temperature'); document.getElementById('temp').style.display='block'" class="w3-button w3-black"><img src={% static 'Plants/images/temp.jpg' %} align="center" style="width:100%"><h1>Temperature</h1></button> </p>
                          <div id="temp" class ="w3-modal">
                                <div class="w3-modal-content w3-animate-zoom">
                                  <div class="w3-container w3-black">
                                    <span onclick="document.getElementById('temp').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
                                    <h1>Temperature</h1>
                                  </div>
                                  <div class="w3-container">
                                    <div id="temperature"></div>
                                  </div>
                                </div>
                              </div>
                        </div>
                </div>
                <div style="float: right;width: 50%;padding-left: 40px ;padding-right: 0px ;padding-bottom: 20px;">
                      <div class="w3-card-4" style="width:100%;padding-left: 70px">
                          
                         <p><button onclick="showGraph({{humidity | getkey:plants.id | safe}}, '#humid'); document.getElementById('humidity').style.display='block'" class="w3-button w3-black"><img src={% static 'Plants/images/humidity.jpg' %} align="center" style="width:100%"><h1>Humidity</h1></button> </p>
                          <div id="humidity" class ="w3-modal">
                                <div class="w3-modal-content w3-animate-zoom">
                                  <div class="w3-container w3-black">
                                    <span onclick="document.getElementById('humidity').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
                                    <h1>Humidity</h1>
                                  </div>
                                  <div class="w3-container">
                                    <div id="humid"></div>
                                  </div>
                                </div>
                              </div>
                        </div>
                </div>
              </div>
              <div class="w3-container" >
                <div style="float: left;width: 50%;padding-left: 20px ;padding-right: 0px ;padding-bottom: 20px;">
                        <div class="w3-card-4" style="width:100%;padding-left: 80px">
                          
                         <p><button onclick="showGraph({{rainfall | getkey:plants.id | safe}}, '#rain'); document.getElementById('rainfall').style.display='block'" class="w3-button w3-black"><img src={% static 'Plants/images/rainfall.jpg' %} align="center" style="width:100%"><h1>Rainfall</h1></button> </p>
                          <div id="rainfall" class ="w3-modal">
                                <div class="w3-modal-content w3-animate-zoom">
                                  <div class="w3-container w3-black">
                                    <span onclick="document.getElementById('rainfall').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
                                    <h1>Rainfall</h1>
                                  </div>
                                  <div class="w3-container">
                                    <div id="rain"></div>
                                  </div>
                                </div>
                              </div>
                        </div>
                </div>
                <div style="float: right;width: 50%;padding-left: 20px ;padding-right: 0px ;padding-bottom: 20px;">
                        <div class="w3-card-4" style="width:100%;padding-left: 80px">
                          
                         <p><button onclick="showGraph({{soil_moisture | getkey:plants.id | safe}}, '#moist'); document.getElementById('moisture').style.display='block'" class="w3-button w3-black"><img src={% static 'Plants/images/Soil_icon.png' %} align="center" style="width:100%"><h1>Soil Moisture</h1></button> </p>
                          <div id="moisture" class ="w3-modal">
                                <div class="w3-modal-content w3-animate-zoom">
                                  <div class="w3-container w3-black">
                                    <span onclick="document.getElementById('moisture').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
                                    <h1>Soil Moisture</h1>
                                  </div>
                                  <div class="w3-container">
                                    <div id="moist"></div>
                                  </div>
                                </div>
                              </div>
                        </div>
                </div>
                 </div>
              </div>
</div>
            <div class="clearfix"></div>
      </div>{% endfor %}
        <br>
        <br>
        <br>
        <br>
        <br>
        <br>



<div id="" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black">
      <span onclick="document.getElementById('tank_1').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>graphs</h1>
    </div>
    <div class="w3-container">
      <div id="char_div_1"></div>
    </div>
  </div>
</div>
<!--maps-->
<div id="plantmap" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black">
      <span onclick="document.getElementById('plantmap').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>Maps: Plants</h1>
    </div>
    <div class="w3-container">
      <div id="maps_plants" style="height: 500px; width: 850px"></div>
    </div>
  </div>
</div>
<div id="tankmap" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black">
      <span onclick="document.getElementById('tankmap').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>Maps: Tanks</h1>
    </div>
    <div class="w3-container">
      <div id="maps_tanks" style="height: 500px; width: 850px"></div>
    </div>
  </div>
</div>

<div id="user" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black">
      <span onclick="document.getElementById('user').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1>Profile</h1>
    </div>
    <div class="w3-container">
      <div id="char_div"></div>
      <h1 style="color: yellow;">Welcome</h1>
      <div class="fourth_div">
            {{ user.username }}
            <br>
             <img src="{{ user.userprofile.picture.url }}" class="w3-border w3-padding" alt="{{user.username}}"> 
          </div>
          <br><br>
    </div>
  </div>
</div>
<!--tank-->


{% for tanks in tank_all %}
<div id="tank{{tanks.id}}" class="w3-modal">
  <div class="w3-modal-content w3-animate-zoom">
    <div class="w3-container w3-black w3-display-container">
      <span onclick="document.getElementById('tank{{tanks.id}}').style.display='none'" class="w3-button w3-display-topright w3-large">x</span>
      <h1> Water Level : Tank {{tanks.id}}</h1>
    </div>
    <div class="w3-container">
      <center>
        <div  id="id2"  >
          <div class="second_div" style="padding-bottom: 80px;">
            <div class="glass">
                  <div class="water" style="height: {{tanks.tank_data_set.last.water_level}}%;"></div>
            </div>
          </div>
          <div class="third_div">
          <br> 
            {{tanks.tank_data_set.last.water_level}} %
            <br><br>
          </div>
        </div>
      </center>
    </div>      
  </div>
    <br>
    <br>
    <br>
    <br>
    <br>
    <br>
</div>
{% endfor %}
</div>
</body>
</html>